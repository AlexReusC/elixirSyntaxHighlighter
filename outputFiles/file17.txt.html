<html><head><link rel='stylesheet' href='styles.css'></head><code><a style='color:violet;'>defmodule</a><a> </a><a style='color:gold;'>Beef</a><a style='color:red;'>.</a><a style='color:gold;'>RoomPermissions</a><a> </a><a style='color:violet;'>do</a><div>
</div><a>  </a><a style='color:violet;'>import</a><a> </a><a style='color:gold;'>Ecto</a><a style='color:red;'>.</a><a style='color:gold;'>Query</a><div>
</div><div>
</div><a>  </a><a style='color:violet;'>def</a><a> </a><a style='color:sandybrown;'>insert</a><a style='color:red;'>(</a><a style='color:sandybrown;'>data</a><a style='color:red;'>)</a><a> </a><a style='color:violet;'>do</a><div>
</div><a>    </a><a style='color:red;'>%</a><a style='color:gold;'>Beef</a><a style='color:red;'>.</a><a style='color:gold;'>Schemas</a><a style='color:red;'>.</a><a style='color:gold;'>RoomPermission</a><a style='color:red;'>{</a><a style='color:red;'>}</a><div>
</div><a>    </a><a style='color:red;'>|></a><a> </a><a style='color:gold;'>Beef</a><a style='color:red;'>.</a><a style='color:gold;'>Schemas</a><a style='color:red;'>.</a><a style='color:gold;'>RoomPermission</a><a style='color:red;'>.</a><a style='color:sandybrown;'>insert_changeset</a><a style='color:red;'>(</a><a style='color:sandybrown;'>data</a><a style='color:red;'>)</a><div>
</div><a>    </a><a style='color:red;'>|></a><a> </a><a style='color:gold;'>Beef</a><a style='color:red;'>.</a><a style='color:gold;'>Repo</a><a style='color:red;'>.</a><a style='color:sandybrown;'>insert</a><a style='color:red;'>(</a><a style='color:#2a6edb;'>on_conflict:</a><a> </a><a style='color:aquamarine;'>:nothing</a><a style='color:red;'>)</a><div>
</div><a>  </a><a style='color:violet;'>end</a><div>
</div><div>
</div><a>  </a><a style='color:violet;'>def</a><a> </a><a style='color:sandybrown;'>upsert</a><a style='color:red;'>(</a><a style='color:sandybrown;'>data</a><a style='color:red;'>,</a><a> </a><a style='color:sandybrown;'>set</a><a style='color:red;'>,</a><a> </a><a style='color:sandybrown;'>returning</a><a> </a><a style='color:red;'>\</a><a style='color:red;'>\</a><a> </a><a style='color:#2a6edb;'>true</a><a style='color:red;'>)</a><a> </a><a style='color:violet;'>do</a><div>
</div><a>    </a><a style='color:red;'>%</a><a style='color:gold;'>Beef</a><a style='color:red;'>.</a><a style='color:gold;'>Schemas</a><a style='color:red;'>.</a><a style='color:gold;'>RoomPermission</a><a style='color:red;'>{</a><a style='color:red;'>}</a><div>
</div><a>    </a><a style='color:red;'>|></a><a> </a><a style='color:gold;'>Beef</a><a style='color:red;'>.</a><a style='color:gold;'>Schemas</a><a style='color:red;'>.</a><a style='color:gold;'>RoomPermission</a><a style='color:red;'>.</a><a style='color:sandybrown;'>insert_changeset</a><a style='color:red;'>(</a><a style='color:sandybrown;'>data</a><a style='color:red;'>)</a><div>
</div><a>    </a><a style='color:red;'>|></a><a> </a><a style='color:gold;'>Beef</a><a style='color:red;'>.</a><a style='color:gold;'>Repo</a><a style='color:red;'>.</a><a style='color:sandybrown;'>insert</a><a style='color:red;'>(</a><div>
</div><a>      </a><a style='color:#2a6edb;'>on_conflict:</a><a> </a><a style='color:red;'>[</a><a style='color:#2a6edb;'>set:</a><a> </a><a style='color:sandybrown;'>set</a><a style='color:red;'>]</a><a style='color:red;'>,</a><div>
</div><a>      </a><a style='color:#2a6edb;'>conflict_target:</a><a> </a><a style='color:red;'>[</a><a style='color:aquamarine;'>:userId</a><a style='color:red;'>,</a><a> </a><a style='color:aquamarine;'>:roomId</a><a style='color:red;'>]</a><a style='color:red;'>,</a><div>
</div><a>      </a><a style='color:#2a6edb;'>returning:</a><a> </a><a style='color:sandybrown;'>returning</a><div>
</div><a>    </a><a style='color:red;'>)</a><div>
</div><a>  </a><a style='color:violet;'>end</a><div>
</div><div>
</div><a>  </a><a style='color:violet;'>def</a><a> </a><a style='color:sandybrown;'>speaker?</a><a style='color:red;'>(</a><a style='color:sandybrown;'>user_id</a><a style='color:red;'>,</a><a> </a><a style='color:sandybrown;'>room_id</a><a style='color:red;'>)</a><a> </a><a style='color:violet;'>do</a><div>
</div><a>    </a><a style='color:violet;'>not</a><a> </a><a style='color:sandybrown;'>is_nil</a><a style='color:red;'>(</a><div>
</div><a>      </a><a style='color:gold;'>Beef</a><a style='color:red;'>.</a><a style='color:gold;'>Repo</a><a style='color:red;'>.</a><a style='color:sandybrown;'>one</a><a style='color:red;'>(</a><div>
</div><a>        </a><a style='color:sandybrown;'>from</a><a style='color:red;'>(</a><a style='color:sandybrown;'>rp</a><a> </a><a style='color:violet;'>in</a><a> </a><a style='color:gold;'>Beef</a><a style='color:red;'>.</a><a style='color:gold;'>Schemas</a><a style='color:red;'>.</a><a style='color:gold;'>RoomPermission</a><a style='color:red;'>,</a><div>
</div><a>          </a><a style='color:#2a6edb;'>where:</a><a> </a><a style='color:sandybrown;'>rp</a><a style='color:red;'>.</a><a style='color:sandybrown;'>roomId</a><a> </a><a style='color:red;'>==</a><a> </a><a style='color:red;'>^</a><a style='color:sandybrown;'>room_id</a><a> </a><a style='color:violet;'>and</a><a> </a><a style='color:sandybrown;'>rp</a><a style='color:red;'>.</a><a style='color:sandybrown;'>userId</a><a> </a><a style='color:red;'>==</a><a> </a><a style='color:red;'>^</a><a style='color:sandybrown;'>user_id</a><a> </a><a style='color:violet;'>and</a><a> </a><a style='color:sandybrown;'>rp</a><a style='color:red;'>.</a><a style='color:sandybrown;'>isSpeaker</a><a> </a><a style='color:red;'>==</a><a> </a><a style='color:#2a6edb;'>true</a><div>
</div><a>        </a><a style='color:red;'>)</a><div>
</div><a>      </a><a style='color:red;'>)</a><div>
</div><a>    </a><a style='color:red;'>)</a><div>
</div><a>  </a><a style='color:violet;'>end</a><div>
</div><div>
</div><a>  </a><a style='color:violet;'>def</a><a> </a><a style='color:sandybrown;'>listener?</a><a style='color:red;'>(</a><a style='color:sandybrown;'>user_id</a><a style='color:red;'>,</a><a> </a><a style='color:sandybrown;'>room_id</a><a style='color:red;'>)</a><a> </a><a style='color:violet;'>do</a><div>
</div><a>    </a><a style='color:violet;'>not</a><a> </a><a style='color:sandybrown;'>speaker?</a><a style='color:red;'>(</a><a style='color:sandybrown;'>user_id</a><a style='color:red;'>,</a><a> </a><a style='color:sandybrown;'>room_id</a><a style='color:red;'>)</a><div>
</div><a>  </a><a style='color:violet;'>end</a><div>
</div><div>
</div><a>  </a><a style='color:violet;'>def</a><a> </a><a style='color:sandybrown;'>mod?</a><a style='color:red;'>(</a><a style='color:sandybrown;'>user_id</a><a style='color:red;'>,</a><a> </a><a style='color:sandybrown;'>room_id</a><a style='color:red;'>)</a><a> </a><a style='color:violet;'>do</a><div>
</div><a>    </a><a style='color:violet;'>not</a><a> </a><a style='color:sandybrown;'>is_nil</a><a style='color:red;'>(</a><div>
</div><a>      </a><a style='color:gold;'>Beef</a><a style='color:red;'>.</a><a style='color:gold;'>Repo</a><a style='color:red;'>.</a><a style='color:sandybrown;'>one</a><a style='color:red;'>(</a><div>
</div><a>        </a><a style='color:sandybrown;'>from</a><a style='color:red;'>(</a><a style='color:sandybrown;'>rp</a><a> </a><a style='color:violet;'>in</a><a> </a><a style='color:gold;'>Beef</a><a style='color:red;'>.</a><a style='color:gold;'>Schemas</a><a style='color:red;'>.</a><a style='color:gold;'>RoomPermission</a><a style='color:red;'>,</a><div>
</div><a>          </a><a style='color:#2a6edb;'>where:</a><a> </a><a style='color:sandybrown;'>rp</a><a style='color:red;'>.</a><a style='color:sandybrown;'>roomId</a><a> </a><a style='color:red;'>==</a><a> </a><a style='color:red;'>^</a><a style='color:sandybrown;'>room_id</a><a> </a><a style='color:violet;'>and</a><a> </a><a style='color:sandybrown;'>rp</a><a style='color:red;'>.</a><a style='color:sandybrown;'>userId</a><a> </a><a style='color:red;'>==</a><a> </a><a style='color:red;'>^</a><a style='color:sandybrown;'>user_id</a><a> </a><a style='color:violet;'>and</a><a> </a><a style='color:sandybrown;'>rp</a><a style='color:red;'>.</a><a style='color:sandybrown;'>isMod</a><a> </a><a style='color:red;'>==</a><a> </a><a style='color:#2a6edb;'>true</a><div>
</div><a>        </a><a style='color:red;'>)</a><div>
</div><a>      </a><a style='color:red;'>)</a><div>
</div><a>    </a><a style='color:red;'>)</a><div>
</div><a>  </a><a style='color:violet;'>end</a><div>
</div><div>
</div><a>  </a><a style='color:violet;'>def</a><a> </a><a style='color:sandybrown;'>asked_to_speak?</a><a style='color:red;'>(</a><a style='color:sandybrown;'>user_id</a><a style='color:red;'>,</a><a> </a><a style='color:sandybrown;'>room_id</a><a style='color:red;'>)</a><a> </a><a style='color:violet;'>do</a><div>
</div><a>    </a><a style='color:violet;'>not</a><a> </a><a style='color:sandybrown;'>is_nil</a><a style='color:red;'>(</a><div>
</div><a>      </a><a style='color:gold;'>Beef</a><a style='color:red;'>.</a><a style='color:gold;'>Repo</a><a style='color:red;'>.</a><a style='color:sandybrown;'>one</a><a style='color:red;'>(</a><div>
</div><a>        </a><a style='color:sandybrown;'>from</a><a style='color:red;'>(</a><a style='color:sandybrown;'>rp</a><a> </a><a style='color:violet;'>in</a><a> </a><a style='color:gold;'>Beef</a><a style='color:red;'>.</a><a style='color:gold;'>Schemas</a><a style='color:red;'>.</a><a style='color:gold;'>RoomPermission</a><a style='color:red;'>,</a><div>
</div><a>          </a><a style='color:#2a6edb;'>where:</a><a> </a><a style='color:sandybrown;'>rp</a><a style='color:red;'>.</a><a style='color:sandybrown;'>roomId</a><a> </a><a style='color:red;'>==</a><a> </a><a style='color:red;'>^</a><a style='color:sandybrown;'>room_id</a><a> </a><a style='color:violet;'>and</a><a> </a><a style='color:sandybrown;'>rp</a><a style='color:red;'>.</a><a style='color:sandybrown;'>userId</a><a> </a><a style='color:red;'>==</a><a> </a><a style='color:red;'>^</a><a style='color:sandybrown;'>user_id</a><a> </a><a style='color:violet;'>and</a><a> </a><a style='color:sandybrown;'>rp</a><a style='color:red;'>.</a><a style='color:sandybrown;'>askedToSpeak</a><a> </a><a style='color:red;'>==</a><a> </a><a style='color:#2a6edb;'>true</a><div>
</div><a>        </a><a style='color:red;'>)</a><div>
</div><a>      </a><a style='color:red;'>)</a><div>
</div><a>    </a><a style='color:red;'>)</a><div>
</div><a>  </a><a style='color:violet;'>end</a><div>
</div><div>
</div><a>  </a><a style='color:violet;'>def</a><a> </a><a style='color:sandybrown;'>get</a><a style='color:red;'>(</a><a style='color:sandybrown;'>user_id</a><a style='color:red;'>,</a><a> </a><a style='color:sandybrown;'>room_id</a><a style='color:red;'>)</a><a> </a><a style='color:violet;'>do</a><div>
</div><a>    </a><a style='color:sandybrown;'>from</a><a style='color:red;'>(</a><a style='color:sandybrown;'>rp</a><a> </a><a style='color:violet;'>in</a><a> </a><a style='color:gold;'>Beef</a><a style='color:red;'>.</a><a style='color:gold;'>Schemas</a><a style='color:red;'>.</a><a style='color:gold;'>RoomPermission</a><a style='color:red;'>,</a><div>
</div><a>      </a><a style='color:#2a6edb;'>where:</a><a> </a><a style='color:sandybrown;'>rp</a><a style='color:red;'>.</a><a style='color:sandybrown;'>userId</a><a> </a><a style='color:red;'>==</a><a> </a><a style='color:red;'>^</a><a style='color:sandybrown;'>user_id</a><a> </a><a style='color:violet;'>and</a><a> </a><a style='color:sandybrown;'>rp</a><a style='color:red;'>.</a><a style='color:sandybrown;'>roomId</a><a> </a><a style='color:red;'>==</a><a> </a><a style='color:red;'>^</a><a style='color:sandybrown;'>room_id</a><a style='color:red;'>,</a><div>
</div><a>      </a><a style='color:#2a6edb;'>limit:</a><a> </a><a style='color:#2a6edb;'>1</a><div>
</div><a>    </a><a style='color:red;'>)</a><div>
</div><a>    </a><a style='color:red;'>|></a><a> </a><a style='color:gold;'>Beef</a><a style='color:red;'>.</a><a style='color:gold;'>Repo</a><a style='color:red;'>.</a><a style='color:sandybrown;'>one</a><a style='color:red;'>(</a><a style='color:red;'>)</a><div>
</div><a>  </a><a style='color:violet;'>end</a><div>
</div><div>
</div><a>  </a><a style='color:violet;'>def</a><a> </a><a style='color:sandybrown;'>ask_to_speak</a><a style='color:red;'>(</a><a style='color:sandybrown;'>user_id</a><a style='color:red;'>,</a><a> </a><a style='color:sandybrown;'>room_id</a><a style='color:red;'>)</a><a> </a><a style='color:violet;'>do</a><div>
</div><a>    </a><a style='color:sandybrown;'>upsert</a><a style='color:red;'>(</a><a style='color:red;'>%{</a><a style='color:#2a6edb;'>roomId:</a><a> </a><a style='color:sandybrown;'>room_id</a><a style='color:red;'>,</a><a> </a><a style='color:#2a6edb;'>userId:</a><a> </a><a style='color:sandybrown;'>user_id</a><a style='color:red;'>,</a><a> </a><a style='color:#2a6edb;'>askedToSpeak:</a><a> </a><a style='color:#2a6edb;'>true</a><a style='color:red;'>}</a><a style='color:red;'>,</a><a> </a><a style='color:#2a6edb;'>askedToSpeak:</a><a> </a><a style='color:#2a6edb;'>true</a><a style='color:red;'>)</a><div>
</div><a>  </a><a style='color:violet;'>end</a><div>
</div><div>
</div><a>  </a><a style='color:violet;'>def</a><a> </a><a style='color:sandybrown;'>set_speaker</a><a style='color:red;'>(</a><a style='color:sandybrown;'>user_id</a><a style='color:red;'>,</a><a> </a><a style='color:sandybrown;'>room_id</a><a style='color:red;'>,</a><a> </a><a style='color:sandybrown;'>speaker?</a><a style='color:red;'>,</a><a> </a><a style='color:sandybrown;'>returning</a><a> </a><a style='color:red;'>\</a><a style='color:red;'>\</a><a> </a><a style='color:#2a6edb;'>false</a><a style='color:red;'>)</a><a> </a><a style='color:violet;'>do</a><div>
</div><a>    </a><a style='color:sandybrown;'>upsert</a><a style='color:red;'>(</a><div>
</div><a>      </a><a style='color:red;'>%{</a><a style='color:#2a6edb;'>roomId:</a><a> </a><a style='color:sandybrown;'>room_id</a><a style='color:red;'>,</a><a> </a><a style='color:#2a6edb;'>userId:</a><a> </a><a style='color:sandybrown;'>user_id</a><a style='color:red;'>,</a><a> </a><a style='color:#2a6edb;'>isSpeaker:</a><a> </a><a style='color:sandybrown;'>speaker?</a><a style='color:red;'>}</a><a style='color:red;'>,</a><div>
</div><a>      </a><a style='color:red;'>[</a><a style='color:#2a6edb;'>isSpeaker:</a><a> </a><a style='color:sandybrown;'>speaker?</a><a style='color:red;'>]</a><a style='color:red;'>,</a><div>
</div><a>      </a><a style='color:sandybrown;'>returning</a><div>
</div><a>    </a><a style='color:red;'>)</a><div>
</div><a>  </a><a style='color:violet;'>end</a><div>
</div><div>
</div><a>  </a><a style='color:violet;'>def</a><a> </a><a style='color:sandybrown;'>set_is_mod</a><a style='color:red;'>(</a><a style='color:sandybrown;'>user_id</a><a style='color:red;'>,</a><a> </a><a style='color:sandybrown;'>room_id</a><a style='color:red;'>,</a><a> </a><a style='color:sandybrown;'>is_mod</a><a style='color:red;'>)</a><a> </a><a style='color:violet;'>do</a><div>
</div><a>    </a><a style='color:sandybrown;'>upsert</a><a style='color:red;'>(</a><div>
</div><a>      </a><a style='color:red;'>%{</a><a style='color:#2a6edb;'>roomId:</a><a> </a><a style='color:sandybrown;'>room_id</a><a style='color:red;'>,</a><a> </a><a style='color:#2a6edb;'>userId:</a><a> </a><a style='color:sandybrown;'>user_id</a><a style='color:red;'>,</a><a> </a><a style='color:#2a6edb;'>isMod:</a><a> </a><a style='color:sandybrown;'>is_mod</a><a style='color:red;'>}</a><a style='color:red;'>,</a><div>
</div><a>      </a><a style='color:red;'>[</a><a style='color:#2a6edb;'>isMod:</a><a> </a><a style='color:sandybrown;'>is_mod</a><a style='color:red;'>]</a><a style='color:red;'>,</a><div>
</div><a>      </a><a style='color:#2a6edb;'>false</a><div>
</div><a>    </a><a style='color:red;'>)</a><div>
</div><a>  </a><a style='color:violet;'>end</a><div>
</div><div>
</div><a>  </a><a style='color:violet;'>def</a><a> </a><a style='color:sandybrown;'>make_listener</a><a style='color:red;'>(</a><a style='color:sandybrown;'>user_id</a><a style='color:red;'>,</a><a> </a><a style='color:sandybrown;'>room_id</a><a style='color:red;'>)</a><a> </a><a style='color:violet;'>do</a><div>
</div><a>    </a><a style='color:sandybrown;'>upsert</a><a style='color:red;'>(</a><div>
</div><a>      </a><a style='color:red;'>%{</a><a style='color:#2a6edb;'>roomId:</a><a> </a><a style='color:sandybrown;'>room_id</a><a style='color:red;'>,</a><a> </a><a style='color:#2a6edb;'>userId:</a><a> </a><a style='color:sandybrown;'>user_id</a><a style='color:red;'>,</a><a> </a><a style='color:#2a6edb;'>isSpeaker:</a><a> </a><a style='color:#2a6edb;'>false</a><a style='color:red;'>,</a><a> </a><a style='color:#2a6edb;'>askedToSpeak:</a><a> </a><a style='color:#2a6edb;'>false</a><a style='color:red;'>}</a><a style='color:red;'>,</a><div>
</div><a>      </a><a style='color:red;'>[</a><a style='color:#2a6edb;'>isSpeaker:</a><a> </a><a style='color:#2a6edb;'>false</a><a style='color:red;'>,</a><a> </a><a style='color:#2a6edb;'>askedToSpeak:</a><a> </a><a style='color:#2a6edb;'>false</a><a style='color:red;'>]</a><a style='color:red;'>,</a><div>
</div><a>      </a><a style='color:#2a6edb;'>false</a><div>
</div><a>    </a><a style='color:red;'>)</a><div>
</div><a>  </a><a style='color:violet;'>end</a><div>
</div><a style='color:violet;'>end</a></code></html>
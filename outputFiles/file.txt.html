<html><head><link rel='stylesheet' href='styles.css'></head><code><a style='color:violet;'>defmodule</a><a> </a><a style='color:gold;'>Broth</a><a style='color:red;'>.</a><a style='color:gold;'>Message</a><a style='color:red;'>.</a><a style='color:gold;'>User</a><a style='color:red;'>.</a><a style='color:gold;'>Update</a><a> </a><a style='color:violet;'>do</a><div>
</div><a>  </a><a style='color:violet;'>alias</a><a> </a><a style='color:gold;'>Beef</a><a style='color:red;'>.</a><a style='color:gold;'>Schemas</a><a style='color:red;'>.</a><a style='color:gold;'>User</a><div>
</div><div>
</div><a>  </a><a style='color:sandybrown;'>use</a><a> </a><a style='color:gold;'>Broth</a><a style='color:red;'>.</a><a style='color:gold;'>Message</a><a style='color:red;'>.</a><a style='color:gold;'>Call</a><a style='color:red;'>,</a><div>
</div><a>    </a><a style='color:#2a6edb;'>schema:</a><a> </a><a style='color:gold;'>User</a><a style='color:red;'>,</a><div>
</div><a>    </a><a style='color:#2a6edb;'>reply:</a><a> </a><a style='color:gold;'>User</a><div>
</div><div>
</div><a>  </a><a style='color:red;'>@</a><a style='color:sandybrown;'>impl</a><a> </a><a style='color:#2a6edb;'>true</a><div>
</div><a>  </a><a style='color:violet;'>def</a><a> </a><a style='color:sandybrown;'>initialize</a><a style='color:red;'>(</a><a style='color:sandybrown;'>state</a><a style='color:red;'>)</a><a> </a><a style='color:violet;'>do</a><div>
</div><a>    </a><a style='color:sandybrown;'>state</a><a style='color:red;'>.</a><a style='color:sandybrown;'>user</a><div>
</div><a>  </a><a style='color:violet;'>end</a><div>
</div><div>
</div><a>  </a><a style='color:red;'>@</a><a style='color:sandybrown;'>impl</a><a> </a><a style='color:#2a6edb;'>true</a><div>
</div><a>  </a><a style='color:violet;'>def</a><a> </a><a style='color:sandybrown;'>changeset</a><a style='color:red;'>(</a><a style='color:sandybrown;'>initializer</a><a> </a><a style='color:red;'>\</a><a style='color:red;'>\</a><a> </a><a style='color:red;'>%</a><a style='color:gold;'>User</a><a style='color:red;'>{</a><a style='color:red;'>}</a><a style='color:red;'>,</a><a> </a><a style='color:sandybrown;'>data</a><a style='color:red;'>)</a><a> </a><a style='color:violet;'>do</a><div>
</div><a>    </a><a style='color:sandybrown;'>initializer</a><div>
</div><a>    </a><a style='color:red;'>|></a><a> </a><a style='color:sandybrown;'>cast</a><a style='color:red;'>(</a><a style='color:sandybrown;'>data</a><a style='color:red;'>,</a><a> </a><a style='color:red;'>[</a><div>
</div><a>      </a><a style='color:aquamarine;'>:muted</a><a style='color:red;'>,</a><div>
</div><a>      </a><a style='color:aquamarine;'>:deafened</a><a style='color:red;'>,</a><div>
</div><a>      </a><a style='color:aquamarine;'>:username</a><a style='color:red;'>,</a><div>
</div><a>      </a><a style='color:aquamarine;'>:bio</a><a style='color:red;'>,</a><div>
</div><a>      </a><a style='color:aquamarine;'>:displayName</a><a style='color:red;'>,</a><div>
</div><a>      </a><a style='color:aquamarine;'>:whisperPrivacySetting</a><div>
</div><a>    </a><a style='color:red;'>]</a><a style='color:red;'>)</a><div>
</div><a>    </a><a style='color:red;'>|></a><a> </a><a style='color:sandybrown;'>validate_required</a><a style='color:red;'>(</a><a style='color:red;'>[</a><a style='color:aquamarine;'>:username</a><a style='color:red;'>]</a><a style='color:red;'>)</a><div>
</div><a>    </a><a style='color:red;'>|></a><a> </a><a style='color:sandybrown;'>update_change</a><a style='color:red;'>(</a><a style='color:aquamarine;'>:displayName</a><a style='color:red;'>,</a><a> </a><a style='color:red;'>&</a><a style='color:gold;'>String</a><a style='color:red;'>.</a><a style='color:sandybrown;'>trim</a><a style='color:red;'>/</a><a style='color:#2a6edb;'>1</a><a style='color:red;'>)</a><div>
</div><a>    </a><a style='color:red;'>|></a><a> </a><a style='color:sandybrown;'>validate_length</a><a style='color:red;'>(</a><a style='color:aquamarine;'>:bio</a><a style='color:red;'>,</a><a> </a><a style='color:#2a6edb;'>min:</a><a> </a><a style='color:#2a6edb;'>0</a><a style='color:red;'>,</a><a> </a><a style='color:#2a6edb;'>max:</a><a> </a><a style='color:#2a6edb;'>160</a><a style='color:red;'>)</a><div>
</div><a>    </a><a style='color:red;'>|></a><a> </a><a style='color:sandybrown;'>validate_length</a><a style='color:red;'>(</a><a style='color:aquamarine;'>:displayName</a><a style='color:red;'>,</a><a> </a><a style='color:#2a6edb;'>min:</a><a> </a><a style='color:#2a6edb;'>2</a><a style='color:red;'>,</a><a> </a><a style='color:#2a6edb;'>max:</a><a> </a><a style='color:#2a6edb;'>50</a><a style='color:red;'>)</a><div>
</div><a>    </a><a style='color:red;'>|></a><a> </a><a style='color:sandybrown;'>validate_format</a><a style='color:red;'>(</a><a style='color:aquamarine;'>:username</a><a style='color:red;'>,</a><a> </a><a style='color:red;'>~</a><a style='color:sandybrown;'>r</a><a style='color:red;'>/</a><a style='color:red;'>^</a><a style='color:red;'>[</a><a style='color:red;'>\</a><a style='color:sandybrown;'>w</a><a style='color:red;'>\</a><a style='color:red;'>.</a><a style='color:red;'>]</a><a style='color:red;'>{</a><a style='color:#2a6edb;'>4</a><a style='color:red;'>,</a><a style='color:#2a6edb;'>15</a><a style='color:red;'>}</a><a style='color:red;'>$</a><a style='color:red;'>/</a><a style='color:red;'>)</a><div>
</div><a>    </a><a style='color:red;'>|></a><a> </a><a style='color:sandybrown;'>validate_format</a><a style='color:red;'>(</a><div>
</div><a>      </a><a style='color:aquamarine;'>:avatarUrl</a><a style='color:red;'>,</a><div>
</div><a>      </a><a style='color:red;'>~</a><a style='color:sandybrown;'>r</a><a style='color:red;'>/</a><a style='color:red;'>^</a><a style='color:#2a6edb;'>https?:</a><a style='color:red;'>\</a><a style='color:red;'>/</a><a style='color:red;'>\</a><a style='color:red;'>/</a><a style='color:red;'>(</a><a style='color:sandybrown;'>www</a><a style='color:red;'>\</a><a style='color:red;'>.</a><a style='color:red;'>|</a><a style='color:red;'>)</a><a style='color:red;'>(</a><a style='color:red;'>(</a><a style='color:sandybrown;'>a</a><a style='color:red;'>|</a><a style='color:sandybrown;'>p</a><a style='color:red;'>)</a><a style='color:sandybrown;'>bs</a><a style='color:red;'>.</a><a style='color:sandybrown;'>twimg</a><a style='color:red;'>.</a><a style='color:sandybrown;'>com</a><a style='color:red;'>\</a><a style='color:red;'>/</a><a style='color:red;'>(</a><a style='color:sandybrown;'>profile_images</a><a style='color:red;'>|</a><a style='color:sandybrown;'>sticky</a><a style='color:red;'>\</a><a style='color:red;'>/</a><a style='color:sandybrown;'>default_profile_images</a><a style='color:red;'>)</a><a style='color:red;'>\</a><a style='color:red;'>/</a><a style='color:red;'>(</a><a style='color:red;'>.</a><a style='color:red;'>*</a><a style='color:red;'>)</a><a style='color:red;'>\</a><a style='color:red;'>.</a><a style='color:red;'>(</a><a style='color:sandybrown;'>jpg</a><a style='color:red;'>|</a><a style='color:sandybrown;'>png</a><a style='color:red;'>|</a><a style='color:sandybrown;'>jpeg</a><a style='color:red;'>|</a><a style='color:sandybrown;'>webp</a><a style='color:red;'>)</a><a style='color:red;'>|</a><a style='color:sandybrown;'>avatars</a><a style='color:red;'>\</a><a style='color:red;'>.</a><a style='color:sandybrown;'>githubusercontent</a><a style='color:red;'>\</a><a style='color:red;'>.</a><a style='color:sandybrown;'>com</a><a style='color:red;'>\</a><a style='color:red;'>/</a><a style='color:sandybrown;'>u</a><a style='color:red;'>\</a><a style='color:red;'>/</a><a style='color:red;'>[</a><a style='color:red;'>^</a><a style='color:red;'>\</a><a style='color:sandybrown;'>s</a><a style='color:red;'>]</a><a style='color:red;'>+</a><a style='color:red;'>|</a><a style='color:sandybrown;'>github</a><a style='color:red;'>.</a><a style='color:sandybrown;'>com</a><a style='color:red;'>\</a><a style='color:red;'>/</a><a style='color:sandybrown;'>identicons</a><a style='color:red;'>\</a><a style='color:red;'>/</a><a style='color:red;'>[</a><a style='color:red;'>^</a><a style='color:red;'>\</a><a style='color:sandybrown;'>s</a><a style='color:red;'>]</a><a style='color:red;'>+</a><a style='color:red;'>|</a><a style='color:sandybrown;'>cdn</a><a style='color:red;'>.</a><a style='color:sandybrown;'>discordapp</a><a style='color:red;'>.</a><a style='color:sandybrown;'>com</a><a style='color:red;'>\</a><a style='color:red;'>/</a><a style='color:sandybrown;'>avatars</a><a style='color:red;'>\</a><a style='color:red;'>/</a><a style='color:red;'>[</a><a style='color:red;'>^</a><a style='color:red;'>\</a><a style='color:sandybrown;'>s</a><a style='color:red;'>]</a><a style='color:red;'>+</a><a style='color:red;'>\</a><a style='color:red;'>/</a><a style='color:red;'>[</a><a style='color:red;'>^</a><a style='color:red;'>\</a><a style='color:sandybrown;'>s</a><a style='color:red;'>]</a><a style='color:red;'>+</a><a style='color:red;'>\</a><a style='color:red;'>.</a><a style='color:red;'>(</a><a style='color:sandybrown;'>jpg</a><a style='color:red;'>|</a><a style='color:sandybrown;'>png</a><a style='color:red;'>|</a><a style='color:sandybrown;'>jpeg</a><a style='color:red;'>|</a><a style='color:sandybrown;'>webp</a><a style='color:red;'>)</a><a style='color:red;'>)</a><a style='color:red;'>/</a><div>
</div><a>    </a><a style='color:red;'>)</a><div>
</div><a>    </a><a style='color:red;'>|></a><a> </a><a style='color:sandybrown;'>validate_format</a><a style='color:red;'>(</a><div>
</div><a>      </a><a style='color:aquamarine;'>:bannerUrl</a><a style='color:red;'>,</a><div>
</div><a>      </a><a style='color:red;'>~</a><a style='color:sandybrown;'>r</a><a style='color:red;'>/</a><a style='color:red;'>^</a><a style='color:#2a6edb;'>https?:</a><a style='color:red;'>\</a><a style='color:red;'>/</a><a style='color:red;'>\</a><a style='color:red;'>/</a><a style='color:red;'>(</a><a style='color:sandybrown;'>www</a><a style='color:red;'>\</a><a style='color:red;'>.</a><a style='color:red;'>|</a><a style='color:red;'>)</a><a style='color:red;'>(</a><a style='color:sandybrown;'>pbs</a><a style='color:red;'>.</a><a style='color:sandybrown;'>twimg</a><a style='color:red;'>.</a><a style='color:sandybrown;'>com</a><a style='color:red;'>\</a><a style='color:red;'>/</a><a style='color:sandybrown;'>profile_banners</a><a style='color:red;'>\</a><a style='color:red;'>/</a><a style='color:red;'>(</a><a style='color:red;'>.</a><a style='color:red;'>+</a><a style='color:red;'>)</a><a style='color:red;'>\</a><a style='color:red;'>/</a><a style='color:red;'>(</a><a style='color:red;'>.</a><a style='color:red;'>+</a><a style='color:red;'>)</a><a style='color:red;'>(</a><a style='color:#2a6edb;'>?:</a><a style='color:red;'>\</a><a style='color:red;'>.</a><a style='color:red;'>(</a><a style='color:sandybrown;'>jpg</a><a style='color:red;'>|</a><a style='color:sandybrown;'>png</a><a style='color:red;'>|</a><a style='color:sandybrown;'>jpeg</a><a style='color:red;'>|</a><a style='color:sandybrown;'>webp</a><a style='color:red;'>)</a><a style='color:red;'>)</a><a style='color:#2a6edb;'>?|</a><a style='color:sandybrown;'>avatars</a><a style='color:red;'>\</a><a style='color:red;'>.</a><a style='color:sandybrown;'>githubusercontent</a><a style='color:red;'>\</a><a style='color:red;'>.</a><a style='color:sandybrown;'>com</a><a style='color:red;'>\</a><a style='color:red;'>/</a><a style='color:sandybrown;'>u</a><a style='color:red;'>\</a><a style='color:red;'>/</a><a style='color:red;'>)</a><a style='color:red;'>/</a><div>
</div><a>    </a><a style='color:red;'>)</a><div>
</div><a>    </a><a style='color:red;'>|></a><a> </a><a style='color:sandybrown;'>unique_constraint</a><a style='color:red;'>(</a><a style='color:aquamarine;'>:username</a><a style='color:red;'>)</a><div>
</div><a>  </a><a style='color:violet;'>end</a><div>
</div><div>
</div><a>  </a><a style='color:red;'>@</a><a style='color:sandybrown;'>impl</a><a> </a><a style='color:#2a6edb;'>true</a><div>
</div><a>  </a><a style='color:violet;'>def</a><a> </a><a style='color:sandybrown;'>execute</a><a style='color:red;'>(</a><a style='color:sandybrown;'>changeset</a><a style='color:red;'>,</a><a> </a><a style='color:sandybrown;'>state</a><a style='color:red;'>)</a><a> </a><a style='color:violet;'>do</a><div>
</div><a>    </a><a style='color:grey;'># TODO: make this a proper changeset-mediated alteration.</a><div>
</div><a>    </a><a style='color:sandybrown;'>case</a><a> </a><a style='color:gold;'>Kousa</a><a style='color:red;'>.</a><a style='color:gold;'>User</a><a style='color:red;'>.</a><a style='color:sandybrown;'>update_with</a><a style='color:red;'>(</a><a style='color:sandybrown;'>changeset</a><a style='color:red;'>)</a><a> </a><a style='color:violet;'>do</a><div>
</div><a>      </a><a style='color:red;'>{</a><a style='color:aquamarine;'>:ok</a><a style='color:red;'>,</a><a> </a><a style='color:sandybrown;'>user</a><a style='color:red;'>}</a><a> </a><a style='color:red;'>-</a><a style='color:red;'>></a><a> </a><a style='color:red;'>{</a><a style='color:aquamarine;'>:reply</a><a style='color:red;'>,</a><a> </a><a style='color:sandybrown;'>user</a><a style='color:red;'>,</a><a> </a><a style='color:red;'>%{</a><a style='color:sandybrown;'>state</a><a> </a><a style='color:red;'>|</a><a> </a><a style='color:#2a6edb;'>user:</a><a> </a><a style='color:sandybrown;'>user</a><a style='color:red;'>}</a><a style='color:red;'>}</a><div>
</div><a>      </a><a style='color:sandybrown;'>error</a><a> </a><a style='color:red;'>-</a><a style='color:red;'>></a><a> </a><a style='color:sandybrown;'>error</a><div>
</div><a>    </a><a style='color:violet;'>end</a><div>
</div><a>  </a><a style='color:violet;'>end</a><div>
</div><a style='color:violet;'>end</a></code></html>
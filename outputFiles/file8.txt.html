<html><head><link rel='stylesheet' href='styles.css'></head><code><div>
</div><a style='color:violet;'>defmodule</a><a> </a><a style='color:gold;'>Broth</a><a style='color:red;'>.</a><a style='color:gold;'>Message</a><a style='color:red;'>.</a><a style='color:gold;'>User</a><a style='color:red;'>.</a><a style='color:gold;'>AdminUpdate</a><a> </a><a style='color:violet;'>do</a><div>
</div><a>  </a><a style='color:violet;'>alias</a><a> </a><a style='color:gold;'>Beef</a><a style='color:red;'>.</a><a style='color:gold;'>Schemas</a><a style='color:red;'>.</a><a style='color:gold;'>User</a><div>
</div><div>
</div><a>  </a><a style='color:sandybrown;'>use</a><a> </a><a style='color:gold;'>Broth</a><a style='color:red;'>.</a><a style='color:gold;'>Message</a><a style='color:red;'>.</a><a style='color:gold;'>Call</a><a style='color:red;'>,</a><div>
</div><a>    </a><a style='color:#2a6edb;'>reply:</a><a> </a><a style='color:gold;'>User</a><div>
</div><div>
</div><a>  </a><a style='color:red;'>@</a><a style='color:sandybrown;'>primary_key</a><a> </a><a style='color:#2a6edb;'>false</a><div>
</div><a>  </a><a style='color:sandybrown;'>embedded_schema</a><a> </a><a style='color:violet;'>do</a><div>
</div><a>    </a><a style='color:sandybrown;'>field</a><a style='color:red;'>(</a><a style='color:aquamarine;'>:id</a><a style='color:red;'>,</a><a> </a><a style='color:aquamarine;'>:binary_id</a><a style='color:red;'>)</a><div>
</div><a>    </a><a style='color:sandybrown;'>embeds_one</a><a style='color:red;'>(</a><a style='color:aquamarine;'>:user</a><a style='color:red;'>,</a><a> </a><a style='color:gold;'>User</a><a style='color:red;'>)</a><div>
</div><a>  </a><a style='color:violet;'>end</a><div>
</div><div>
</div><a>  </a><a style='color:violet;'>alias</a><a> </a><a style='color:gold;'>Beef</a><a style='color:red;'>.</a><a style='color:gold;'>Users</a><div>
</div><div>
</div><a>  </a><a style='color:violet;'>def</a><a> </a><a style='color:sandybrown;'>user_admin_changeset</a><a style='color:red;'>(</a><a style='color:grey;'>_</a><a style='color:red;'>,</a><a> </a><a style='color:sandybrown;'>data</a><a style='color:red;'>,</a><a> </a><a style='color:sandybrown;'>user</a><a style='color:red;'>)</a><a> </a><a style='color:violet;'>do</a><div>
</div><a>    </a><a style='color:sandybrown;'>user</a><div>
</div><a>    </a><a style='color:red;'>|></a><a> </a><a style='color:sandybrown;'>cast</a><a style='color:red;'>(</a><a style='color:sandybrown;'>data</a><a style='color:red;'>,</a><a> </a><a style='color:red;'>[</a><a style='color:aquamarine;'>:staff</a><a style='color:red;'>,</a><a> </a><a style='color:aquamarine;'>:contributions</a><a style='color:red;'>]</a><a style='color:red;'>)</a><div>
</div><a>  </a><a style='color:violet;'>end</a><div>
</div><div>
</div><a>  </a><a style='color:red;'>@</a><a style='color:sandybrown;'>impl</a><a> </a><a style='color:#2a6edb;'>true</a><div>
</div><a>  </a><a style='color:violet;'>def</a><a> </a><a style='color:sandybrown;'>changeset</a><a style='color:red;'>(</a><a style='color:sandybrown;'>initializer</a><a> </a><a style='color:red;'>\</a><a style='color:red;'>\</a><a> </a><a style='color:red;'>%</a><a style='color:grey;'>__MODULE__</a><a style='color:red;'>{</a><a style='color:red;'>}</a><a style='color:red;'>,</a><a> </a><a style='color:sandybrown;'>data</a><a style='color:red;'>)</a><a> </a><a style='color:violet;'>do</a><div>
</div><a>    </a><a style='color:sandybrown;'>initializer</a><div>
</div><a>    </a><a style='color:red;'>|></a><a> </a><a style='color:sandybrown;'>cast</a><a style='color:red;'>(</a><a style='color:sandybrown;'>data</a><a style='color:red;'>,</a><a> </a><a style='color:red;'>[</a><a style='color:aquamarine;'>:id</a><a style='color:red;'>]</a><a style='color:red;'>)</a><div>
</div><a>    </a><a style='color:red;'>|></a><a> </a><a style='color:sandybrown;'>validate_required</a><a style='color:red;'>(</a><a style='color:red;'>[</a><a style='color:aquamarine;'>:id</a><a style='color:red;'>]</a><a style='color:red;'>)</a><div>
</div><a>    </a><a style='color:red;'>|></a><a> </a><a style='color:sandybrown;'>cast_embed</a><a style='color:red;'>(</a><a style='color:aquamarine;'>:user</a><a style='color:red;'>,</a><div>
</div><a>      </a><a style='color:#2a6edb;'>with:</a><div>
</div><a>        </a><a style='color:red;'>{</a><a style='color:grey;'>__MODULE__</a><a style='color:red;'>,</a><a> </a><a style='color:aquamarine;'>:user_admin_changeset</a><a style='color:red;'>,</a><div>
</div><a>         </a><a style='color:red;'>[</a><div>
</div><a>           </a><a style='color:sandybrown;'>if</a><a style='color:red;'>(</a><a style='color:violet;'>not</a><a> </a><a style='color:sandybrown;'>is_nil</a><a style='color:red;'>(</a><a style='color:sandybrown;'>data</a><a style='color:red;'>[</a><a style='color:greenyellow;'>"id"</a><a style='color:red;'>]</a><a style='color:red;'>)</a><a style='color:red;'>,</a><div>
</div><a>             </a><a style='color:#2a6edb;'>do:</a><a> </a><a style='color:gold;'>Users</a><a style='color:red;'>.</a><a style='color:sandybrown;'>get_by_id</a><a style='color:red;'>(</a><a style='color:sandybrown;'>data</a><a style='color:red;'>[</a><a style='color:greenyellow;'>"id"</a><a style='color:red;'>]</a><a style='color:red;'>)</a><a style='color:red;'>,</a><div>
</div><a>             </a><a style='color:#2a6edb;'>else:</a><a> </a><a style='color:red;'>%</a><a style='color:gold;'>User</a><a style='color:red;'>{</a><a style='color:red;'>}</a><div>
</div><a>           </a><a style='color:red;'>)</a><div>
</div><a>         </a><a style='color:red;'>]</a><a style='color:red;'>}</a><a style='color:red;'>,</a><div>
</div><a>      </a><a style='color:#2a6edb;'>required:</a><a> </a><a style='color:#2a6edb;'>true</a><div>
</div><a>    </a><a style='color:red;'>)</a><div>
</div><a>  </a><a style='color:violet;'>end</a><div>
</div><div>
</div><a>  </a><a style='color:violet;'>alias</a><a> </a><a style='color:gold;'>Broth</a><a style='color:red;'>.</a><a style='color:gold;'>SocketHandler</a><div>
</div><div>
</div><a>  </a><a style='color:red;'>@</a><a style='color:sandybrown;'>impl</a><a> </a><a style='color:#2a6edb;'>true</a><div>
</div><a>  </a><a style='color:violet;'>def</a><a> </a><a style='color:sandybrown;'>execute</a><a style='color:red;'>(</a><a style='color:sandybrown;'>changeset</a><a style='color:red;'>,</a><a> </a><a style='color:red;'>%</a><a style='color:gold;'>SocketHandler</a><a style='color:red;'>{</a><a style='color:red;'>}</a><a> </a><a style='color:red;'>=</a><a> </a><a style='color:sandybrown;'>state</a><a style='color:red;'>)</a><a> </a><a style='color:violet;'>do</a><div>
</div><a>    </a><a style='color:sandybrown;'>with</a><a> </a><a style='color:red;'>%</a><a style='color:gold;'>Ecto</a><a style='color:red;'>.</a><a style='color:gold;'>Changeset</a><a style='color:red;'>{</a><a style='color:#2a6edb;'>changes:</a><a> </a><a style='color:red;'>%{</a><a style='color:#2a6edb;'>user:</a><a> </a><a style='color:sandybrown;'>user_changeset</a><a style='color:red;'>}</a><a style='color:red;'>}</a><a> </a><a style='color:red;'><</a><a style='color:red;'>-</a><a> </a><a style='color:sandybrown;'>changeset</a><a> </a><a style='color:violet;'>do</a><div>
</div><a>      </a><a style='color:grey;'># @todo we are changing the values for another user</a><div>
</div><a>      </a><a style='color:grey;'># we need to update the cached data in that users ws</a><div>
</div><a>      </a><a style='color:sandybrown;'>case</a><a> </a><a style='color:gold;'>Kousa</a><a style='color:red;'>.</a><a style='color:gold;'>User</a><a style='color:red;'>.</a><a style='color:sandybrown;'>admin_update_with</a><a style='color:red;'>(</a><div>
</div><a>             </a><a style='color:red;'>%{</a><a style='color:sandybrown;'>user_changeset</a><a> </a><a style='color:red;'>|</a><a> </a><a style='color:#2a6edb;'>action:</a><a> </a><a style='color:aquamarine;'>:update</a><a style='color:red;'>}</a><a style='color:red;'>,</a><div>
</div><a>             </a><a style='color:sandybrown;'>state</a><a style='color:red;'>.</a><a style='color:sandybrown;'>user</a><div>
</div><a>           </a><a style='color:red;'>)</a><a> </a><a style='color:violet;'>do</a><div>
</div><a>        </a><a style='color:red;'>{</a><a style='color:aquamarine;'>:ok</a><a style='color:red;'>,</a><a> </a><a style='color:sandybrown;'>user</a><a style='color:red;'>}</a><a> </a><a style='color:red;'>-</a><a style='color:red;'>></a><a> </a><a style='color:red;'>{</a><a style='color:aquamarine;'>:reply</a><a style='color:red;'>,</a><a> </a><a style='color:sandybrown;'>user</a><a style='color:red;'>,</a><a> </a><a style='color:sandybrown;'>state</a><a style='color:red;'>}</a><div>
</div><a>        </a><a style='color:sandybrown;'>error</a><a> </a><a style='color:red;'>-</a><a style='color:red;'>></a><a> </a><a style='color:sandybrown;'>error</a><div>
</div><a>      </a><a style='color:violet;'>end</a><div>
</div><a>    </a><a style='color:violet;'>end</a><div>
</div><a>  </a><a style='color:violet;'>end</a><div>
</div><a style='color:violet;'>end</a></code></html>